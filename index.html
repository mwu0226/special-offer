<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品展示</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #searchBox { margin-bottom: 20px; }
        .product { border: 1px solid #ddd; padding: 10px; margin: 10px; border-radius: 5px; }
        .product img { max-width: 100%; height: auto; display: block; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>商品列表</h1>
    <input type="text" id="searchBox" placeholder="搜索..." oninput="filterProducts()">
    <select id="categoryFilter" onchange="filterProducts()">
        <option value="">所有类别</option>
    </select>
    <div id="productList"></div>

    <script>
        let allProducts = [];

        async function fetchProducts() {
            const response = await fetch("https://api.github.com/repos/你的GitHub用户名/special-offer/issues");
            const issues = await response.json();
            
            allProducts = issues.map(issue => ({
                title: issue.title,
                body: issue.body,
                category: extractText(issue.body, "分类"),
                price: extractText(issue.body, "价格"),
                images: extractImages(issue.body)
            }));

            populateCategories();
            displayProducts(allProducts);
        }

        function extractText(text, label) {
            const match = text.match(new RegExp(`\\*\\*${label}\\*\\*:\\s*(.*)`));
            return match ? match[1].trim() : "未知";
        }

        function extractImages(text) {
            return [...text.matchAll(/!\[.*?\]\((.*?)\)/g)].map(match => match[1]);
        }

        function displayProducts(products) {
            let productList = document.getElementById("productList");
            productList.innerHTML = "";

            products.forEach(product => {
                let div = document.createElement("div");
                div.className = "product";

                let imagesHTML = product.images.map(img => `<img src="${img}" alt="商品图片">`).join("");

                div.innerHTML = `
                    <h3>${product.title}</h3>
                    <p><b>价格:</b> ${product.price}</p>
                    <p><b>分类:</b> ${product.category}</p>
                    <p>${product.body.replace(/\*\*(.*?)\*\*/g, "<b>$1</b>").replace(/\n/g, "<br>")}</p>
                    ${imagesHTML}
                `;

                productList.appendChild(div);
            });
        }

        function populateCategories() {
            let categories = [...new Set(allProducts.map(p => p.category))];
            let categoryFilter = document.getElementById("categoryFilter");
            categoryFilter.innerHTML = `<option value="">所有类别</option>` + categories.map(c => `<option value="${c}">${c}</option>`).join("");
        }

        function filterProducts() {
            let searchQuery = document.getElementById("searchBox").value.toLowerCase();
            let selectedCategory = document.getElementById("categoryFilter").value;

            let filtered = allProducts.filter(product => 
                (product.title.toLowerCase().includes(searchQuery) || 
                 product.body.toLowerCase().includes(searchQuery) || 
                 product.category.toLowerCase().includes(searchQuery)) &&
                (selectedCategory === "" || product.category === selectedCategory)
            );

            displayProducts(filtered);
        }

        fetchProducts();
    </script>
</body>
</html>
